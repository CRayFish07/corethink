<extend name="Public/layout"/>

<block name="body">
    <div class="title">
        <h2>{$meta_title}</h2>
    </div>
    <div class="row">
        <form action="__SELF__" method="post" class="form">
            <div class="form-group">
                <label class="item-label">文章<span class="check-tips">（文章所属的分类）</span></label>
                <div class="controls">
                    <select name="cid" class="form-control">
                        <volist name="all_category" id="_category">
                            <option value="{$_category.id}" 
                                <php>if($_category['id'] == $info['cid']) echo 'selected="selected"';</php> >
                                {$_category.title_show}
                            </option>
                        </volist>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="item-label">文章标题<span class="check-tips">（文章标题）</span></label>
                <div class="controls">
                    <input type="text" class="form-control" name="title" value="{$info.title|default=''}">
                </div>
            </div>
            <div class="form-group">
                <label class="item-label">文章摘要<span class="check-tips">（文章内容摘要）</span></label>
                <div class="controls">
                    <textarea class="form-control" name="remark">{$info.abstract|default=''}</textarea>
                </div>
            </div>
            <div class="form-group content">
                <label class="item-label">文章内容<span class="check-tips">（文章正文内容）</span></label>
                <div class="controls">
                    <textarea class="form-control" name="content">{$info.content|default=''}</textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="item-label">封面图片<span class="check-tips">（文章封面图片）</span></label>
                <div class="controls">
                    <div id="upload"></div>
                    <div id="preview">
                        <input type="hidden" name="cover" value="{$info.cover}">
                        <img style="margin-top:8px;max-height:120px;" src="{$info.cover|get_cover}">
                    </div>
                    <link rel="stylesheet" type="text/css" href="__PUBLIC__/huploadify/huploadify.css">
                    <script type="text/javascript" src="__PUBLIC__/huploadify/huploadify.js" charset="utf-8"></script>
                    <script type="text/javascript">
                        $('#upload').Huploadify({
                            uploader:'{:U("Upload/upload")}',
                            fileTypeExts:'*.gif;*.jpg;*.jpeg;*.png;*.bmp',
                            fileSizeLimit:{:C('UPLOAD_IMAGE_SIZE')}*1024,
                            buttonText:'上 传 图 片',
                            onUploadComplete:function(file, data){
                                var data = $.parseJSON(data);
                                $('#preview img').attr('src', data.url);
                                $('#preview input').attr('value', data.id);
                            }
                        });
                    </script>
                </div>
            </div>
            <div class="form-group">
                <label class="item-label">排序<span class="check-tips">（用于分组显示的顺序）</span></label>
                <div class="controls">
                    <input type="text" class="form-control" name="sort" value="{$info.sort|default=0}">
                </div>
            </div>
            <div class="form-group">
                <input type="hidden" name="id" value="{$info.id|default=''}">
                <button class="btn ajax-post"  type="submit" target-form="form">确 定</button>
                <button class="btn" onclick="javascript:history.back(-1);return false;">返 回</button>
            </div>
        </form>
    </div>
</block>

<block name="script">
    <script type="text/javascript">
        var editor_content;
        KindEditor.ready(function(K) {
            editor_content = K.create('textarea[name="content"]', {
                allowFileManager : true,
                width: '100%',
                height: '500px',
                cssPath : [
                    '__PUBLIC__/zui/css/zui.min.css',
                    '__PUBLIC__/kindeditor/plugins/code/prettify.css'
                ],
                resizeType: 1,
                pasteType : 2,
                urlType : 'absolute',
                items : [{:C('EDITOR_STYLE_DEFAULT')}],
                fileManagerJson : '{:U("Upload/fileManager")}',
                uploadJson : '{:U("Upload/upload")}',
                remoteImgSaveUrl: '{:U("Upload/downremoteimg")}',
                extraFileUploadParams: {
                    session_id : '{:session_id()}'
                },
                afterBlur: function(){this.sync();},
                autoSaveMode:true,
                autoSaveInterval:100,
                afterCreate: function() {
                    this.loadPlugin('autosave');
                }
            });
        });
    </script>
</block>
